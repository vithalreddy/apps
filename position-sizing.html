<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Swing Position Sizer — Bootstrap + Alpine</title>
  <!-- Bootstrap 5 (latest stable) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Alpine.js (latest 3.x) -->
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; }
    .target-badge { font-weight:600 }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4" x-data="swingSizer()" x-init="init()">
    <div class="d-flex align-items-center mb-3">
      <h3 class="me-auto">Position Sizing and RR Calculator in Rupess</h3>
      <div class="text-muted small">Know your risk</div>
    </div>

    <div class="row g-3">
      <div class="col-lg-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Global config</h5>

            <label class="form-label">Account capital</label>
            <div class="input-group mb-2">
              <span class="input-group-text">₹</span>
              <input x-model.number="capital" type="number" min="1" step="0.01" class="form-control" placeholder="100000">
            </div>
            <div class="form-text mb-3">Saved locally in browser</div>

            <h6 class="mt-2">Trade inputs</h6>
            <div class="mb-2">
              <label class="form-label">Symbol / name</label>
              <input x-model="symbol" class="form-control" placeholder="TCS / NIFTY">
            </div>
            <div class="mb-2">
              <label class="form-label">Direction</label>
              <select x-model="direction" class="form-select">
                <option value="long">Long</option>
                <option value="short">Short</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">Entry price</label>
              <input x-model.number="entry" type="number" step="0.0001" class="form-control" placeholder="e.g. 4500">
            </div>
            <div class="mb-2">
              <label class="form-label">Stop loss price</label>
              <input x-model.number="stop" type="number" step="0.0001" class="form-control" placeholder="e.g. 4400">
            </div>
            <div class="mb-2">
              <label class="form-label">Per-unit multiplier (optional)</label>
              <input x-model.number="tick" type="number" step="0.0001" class="form-control" placeholder="1 (default)">
              <div class="form-text">Set if instrument uses lot/tick multiplier (optional).</div>
            </div>

            <div class="d-flex gap-2 mt-3">
              <button @click.prevent="calc()" class="btn btn-primary">Calculate</button>
              <button @click.prevent="saveConfig()" class="btn btn-outline-secondary" x-text="saveBtnText"></button>
              <button @click.prevent="clearAll()" class="btn btn-outline-danger">Clear saved</button>
            </div>

            <div class="mt-3 small text-muted">
              <strong>Notes:</strong>
              <ul>
                <li>Calculates qty for account-risk: 1%–5%.</li>
                <li>Targets: R:R 1:1 → 1:5.</li>
                <li>All data persisted in localStorage — ready for CodePen.</li>
              </ul>
            </div>
          </div>
        </div>

      </div>

      <div class="col-lg-8">
        <div class="card shadow-sm mb-3">
          <div class="card-body">
            <div class="d-flex align-items-center mb-2">
              <h5 class="me-auto">Results</h5>
              <div class="text-muted small">Copy a row • Save rows</div>
            </div>

            <div x-show="!calculated" class="text-muted">No calculation yet — enter trade details and click <strong>Calculate</strong>.</div>

            <div x-show="calculated" class="table-responsive">
              <table class="table table-hover align-middle">
                <thead>
                  <tr>
                    <th>Risk %</th>
                    <th>Risk ₹</th>
                    <th>Qty</th>
                    <th>Risk/unit ₹</th>
                    <th>Targets (1:1 → 1:5)</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <template x-for="row in rows" :key="row.risk">
                    <tr>
                      <td x-text="row.risk + '%'" class="mono"></td>
                      <td>₹ <span x-text="format(row.riskAmt)"></span></td>
                      <td class="mono" x-text="row.qty"></td>
                      <td>₹ <span x-text="format(row.perUnitRisk)"></span></td>
                      <td>
                        <template x-for="t in row.targets" :key="t.rr">
                          <span class="badge bg-light text-dark me-1 mono target-badge" x-text="t.rr+':1 → '+format(t.price)"></span>
                        </template>
                      </td>
                      <td class="text-end">
                        <button @click.prevent="copyRow(row)" class="btn btn-sm btn-outline-primary me-1">Copy</button>
                        <button @click.prevent="saveRow(row)" class="btn btn-sm btn-outline-success">Save</button>
                      </td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>

          </div>
        </div>

        <div class="card shadow-sm">
          <div class="card-body">
            <div class="d-flex align-items-center mb-2">
              <h5 class="me-auto">Saved trades (local)</h5>
              <div class="text-muted small">Stored in this browser</div>
            </div>

            <template x-if="saved.length === 0">
              <div class="text-muted">No saved trades yet.</div>
            </template>

            <template x-if="saved.length > 0">
              <div class="list-group">
                <template x-for="t in saved" :key="t.id">
                  <div class="list-group-item d-flex justify-content-between align-items-start">
                    <div>
                      <div class="fw-semibold mono" x-text="(t.symbol || '-') + ' ('+t.direction+')'"></div>
                      <div class="small text-muted">Entry <span x-text="t.entry"></span> • Stop <span x-text="t.stop"></span> • Qty <span x-text="t.qty"></span> • Risk <span x-text="t.riskPct+'%' "></span></div>
                    </div>
                    <div class="btn-group">
                      <button @click.prevent="copySaved(t)" class="btn btn-sm btn-outline-primary">Copy</button>
                      <button @click.prevent="deleteSaved(t.id)" class="btn btn-sm btn-outline-danger">Del</button>
                    </div>
                  </div>
                </template>
              </div>
            </template>

          </div>
        </div>

      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function swingSizer(){
      return {
        capital: 100000,
        symbol: '',
        direction: 'long',
        entry: null,
        stop: null,
        tick: 1,

        rows: [],
        saved: [],
        calculated: false,
        saveBtnText: 'Save',

        init(){
          const raw = localStorage.getItem('swing-sizer-bs');
          if(raw){
            try{
              const state = JSON.parse(raw);
              this.capital = state.capital ?? this.capital;
              this.saved = state.savedTrades ?? [];
            }catch(e){ console.warn('load failed', e); }
          }
        },

        format(v){
          if(v===null || v===undefined || isNaN(v)) return '-';
          return Number(v).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
        },

        calc(){
          if(!this.capital || !this.entry || !this.stop){
            alert('Please enter account capital, entry and stop prices.');
            return;
          }
          if(this.entry === this.stop){ alert('Entry and Stop cannot be equal.'); return; }

          const perUnitRisk = Math.abs(this.entry - this.stop) * (this.tick || 1);
          if(perUnitRisk <= 0){ alert('Per-unit risk invalid'); return; }

          const risks = [1,2,3,4,5];
          this.rows = risks.map(rpct => {
            const riskAmt = (rpct/100) * this.capital;
            const rawQty = riskAmt / perUnitRisk;
            const qty = Math.max(0, Math.floor(rawQty));
            const targets = [];
            for(let rr=1; rr<=5; rr++){
              const profitPerUnit = perUnitRisk * rr;
              let targetPrice = this.direction === 'long' ? this.entry + (profitPerUnit / (this.tick || 1)) : this.entry - (profitPerUnit / (this.tick || 1));
              targets.push({ rr, price: targetPrice });
            }
            return { risk: rpct, riskAmt, qty, perUnitRisk, targets };
          });

          this.calculated = true;
        },

        copyRow(row){
          const parts = [];
          parts.push(`Symbol: ${this.symbol}`);
          parts.push(`Direction: ${this.direction}`);
          parts.push(`Entry: ${this.entry}`);
          parts.push(`Stop: ${this.stop}`);
          parts.push(`Qty: ${row.qty}`);
          parts.push(`Risk%: ${row.risk}%`);
          parts.push(`Risk/unit: ₹ ${this.format(row.perUnitRisk)}`);
          row.targets.forEach(t => parts.push(`Target ${t.rr}:1 → ${this.format(t.price)}`));
          navigator.clipboard.writeText(parts.join('
')).then(()=>{
            this._flashMsg('Row copied');
          }).catch(()=> this._flashMsg('Copy failed'));
        },

        saveRow(row){
          const item = { id: Date.now(), symbol: this.symbol, direction: this.direction, entry: this.entry, stop: this.stop, qty: row.qty, riskPct: row.risk };
          this.saved.unshift(item);
          if(this.saved.length > 200) this.saved.pop();
          this._persist();
          this._flashMsg('Saved');
        },

        copySaved(t){
          const txt = `Symbol: ${t.symbol}
Direction: ${t.direction}
Entry: ${t.entry}
Stop: ${t.stop}
Qty: ${t.qty}
Risk%: ${t.riskPct}%`;
          navigator.clipboard.writeText(txt).then(()=> this._flashMsg('Saved trade copied'));
        },

        deleteSaved(id){
          if(!confirm('Delete this saved trade?')) return;
          this.saved = this.saved.filter(s => s.id !== id);
          this._persist();
        },

        saveConfig(){
          this._persist();
          this.saveBtnText = 'Saved';
          setTimeout(()=> this.saveBtnText = 'Save', 900);
        },

        clearAll(){
          if(!confirm('Clear all saved data from this browser?')) return;
          localStorage.removeItem('swing-sizer-bs');
          location.reload();
        },

        _persist(){
          const payload = { capital: this.capital, savedTrades: this.saved };
          localStorage.setItem('swing-sizer-bs', JSON.stringify(payload));
        },

        _flashMsg(msg){
          // small transient bootstrap toast-like feedback via alert
          const el = document.createElement('div');
          el.className = 'position-fixed bottom-0 end-0 p-3';
          el.style.zIndex = 1080;
          el.innerHTML = `<div class=\"toast align-items-center text-bg-primary border-0 show\"><div class=\"d-flex\"><div class=\"toast-body\">${msg}</div><button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\"></button></div></div>`;
          document.body.appendChild(el);
          setTimeout(()=> el.remove(), 1600);
        }
      };
    }
  </script>
</body>
</html>
